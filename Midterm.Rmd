---
title: "E-commerce Business Transaction Analysis"
author: "Team 3"
date: "March 16 2024"
# date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
knitr::opts_chunk$set(warning = F, results = "markup", message = F)
#knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

## Loading the Dataset

```{r}

# Reading the dataset

data = read.csv("Sales_Transaction.csv")

# Structure of the dataset

str(data)

```

## Summary of the dataset

```{r}
# Before Cleaning the Data

summary(data)
```

#### Summary:

1.  Dataset contain **536350** entries of row and **8** columns.
2.  Column 'Date' should be 'Date' format for better analysis.
3.  Column 'Quantity' contain negative value.
4.  The 'CustomerNo' column has some missing values.
5.  In TransactionNo column, some value have letter "C" in the first string. That mean **CANCELLATION.**

## Data Cleaning

#### Remove NA Values:

```{r}
# Remove rows with NA in dataset

data <- na.omit(data)

summary(data)

```

```{r}
# unique products count
unique_products_count <- length(unique(data$ProductNo))

# unique customers count
unique_customers_count <- length(unique(data$CustomerNo))

# unique countries  count
unique_countries_count <- length(unique(data$Country))

cat("Count of Unique Products:", unique_products_count, "\n")

cat("Count of Unique Customers:", unique_customers_count, "\n")

cat("Count of Unique Countries:", unique_countries_count, "\n")

#### Removing Duplicate Values:

# check for Duplicate Rows

sum(duplicated(data))

# Remove duplicate rows

library(dplyr)

data <- data %>% distinct()

# Checking for number of duplicated rows.

sum(duplicated(data))


```

```{r}
# Removing rows where 'TransactionNo' starts with 'C'

data <- data[!grepl("^C", data$TransactionNo),]

# Remove rows where 'Quantity' is less than 0

data <- data[data$Quantity >=0,]


```

```{r}
# Converts date strings to Date objects

data$Date <- as.Date(data$Date, format = "%m/%d/%Y")

# Convert character variables to factors

data$Country <- as.factor(data$Country)

```

#### Creating Features:

```{r}
# Make a column Revenue

data$Revenue <- data$Price * data$Quantity

library(lubridate)

# Day of the Week

data$DayofWeek <- wday(data$Date , label = TRUE)

# Make a Month column

data$Month <- month(data$Date, label=TRUE)

```

#### Summary of the Cleaned Dataset:

```{r}
# After cleaned the dataset

summary(data)
```

```{r}
# Structure of the dataset

str(data)
```

## **EXPLORATORY DATA ANALYSIS**

### Distribution of the variables:

```{r}

# Creating Histogram plot and Q-Q plot to see distribution of the Variables

library(ggplot2)


ggplot(data, aes(x=Price)) +
  geom_histogram(fill='green', color = "red") +
  xlim(0,50)+
  labs(title="Distribution of Price", x="Price", y='density')
  
qqnorm(data$Price, main='Q-Q Plot of Price', col='blue')
qqline(data$Price, col='black')



  

```

The Q-Q plot of the 'Price' data indicates a deviation from the normal distribution. The central values align closely with the theoretical line, suggesting normality in the mid-range of the data.

```{r}

ggplot(data, aes(x=Quantity)) +
  geom_histogram(binwidth= 1,fill='green', color = "red") +
  labs(title="Distribution of Quantity", x="Quantity", y='Density')
  
qqnorm(data$Price, main='Q-Q Plot of Price', col='blue')
qqline(data$Price, col='black')

```

```{r}
ggplot(data, aes(x=Revenue)) +
  geom_histogram(fill='green', color = "red") +
  xlim(0,1000)+
  labs(title="Distribution of Revenue", x="Revenue", y='density')
  
qqnorm(data$Price, main='Q-Q Plot of Revenue', col='blue')
qqline(data$Price, col='black')
```

In these graphs, the data are not normally distributed and contain outliers on the higher end of the scale.

#### 
```{r}
library("ggplot2")

#removing quantity outliers
data2 = outlierKD2(data, Quantity, rm=TRUE, boxplt=FALSE, histogram=FALSE, qqplt=TRUE) 

# Count of NA values in quantity 
na_quantity <- sum(is.na(data2$Quantity))
cat("Number of NA values in Quantity:", na_quantity, "\n")

#removing price outliers
data3 = outlierKD2(data2, Price, rm=TRUE, boxplt=FALSE, histogram=FALSE, qqplt=TRUE) 

# Count of NA values in price
na_price <- sum(is.na(data3$Price))
cat("Number of NA values in Price:", na_price, "\n")

#removing revenue outliers
datanew = outlierKD2(data3, Revenue, rm=TRUE, boxplt=FALSE, histogram=FALSE, qqplt=TRUE) 

# Count of NA values in revenue 
na_revenue <- sum(is.na(datanew$Revenue))
cat("Number of NA values in revenue:", na_revenue, "\n")


#after  the outliers are removed , they  are replaced with NA values hence  removing the rows containing those NA values

datanew <- na.omit(datanew)

summary(datanew)

```

